<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/careers">
  <collaboration id="Collaboration">
    <participant id="sid-DF77EB5C-7308-429E-8401-838B15EC5344" processRef="csuChangeProcess"></participant>
  </collaboration>
  <process id="csuChangeProcess" name="Cambio de CSU (Manual)" isExecutable="true">
    <documentation>{"translationPrefix": "csuChangeProcess", "estimatedDuration": 5, "sideComponents":[{"name":"comments"},{"name":"attachments"},{"name":"timeline"}]}</documentation>
    <laneSet id="laneSet_csuChangeProcess">
      <lane id="sid-0AD809AE-4631-459E-97F9-A73F84FD514E">
        <flowNodeRef>Notificacion</flowNodeRef>
        <flowNodeRef>startForm</flowNodeRef>
        <flowNodeRef>sid-2295E5D2-51B4-4841-B58B-76EF76208470</flowNodeRef>
        <flowNodeRef>sid-806D3E4C-780F-4A73-94A7-68080BD47BD1</flowNodeRef>
        <flowNodeRef>createCrmCase</flowNodeRef>
        <flowNodeRef>notifyGroups</flowNodeRef>
        <flowNodeRef>notifyUser</flowNodeRef>
      </lane>
      <lane id="sid-D10A8765-2E2F-4B3D-BC65-790CB3CFEE03">
        <flowNodeRef>exclusivegateway1</flowNodeRef>
        <flowNodeRef>updateCrmCase</flowNodeRef>
        <flowNodeRef>notifyUser</flowNodeRef>
        <flowNodeRef>fetchValidationValues</flowNodeRef>
        <flowNodeRef>validateRequest</flowNodeRef>
        <flowNodeRef>updateScheduleInBanner</flowNodeRef>
        <flowNodeRef>notifyClosureToUser</flowNodeRef>
        <flowNodeRef>endevent1</flowNodeRef>
        <flowNodeRef>endingNotification</flowNodeRef>
      </lane>
    </laneSet>
    <startEvent id="startForm" name="Inicio" activiti:formKey="formularioInicio">
      <documentation>{"translationPrefix":"initialForm","fields":{"actualDate":{"renderAs":"date"},"studentId":{"renderAs":"textBox"},"student":{"renderAs":"textBox"},"studentEmail":{"renderAs":"textBox"},"program":{"renderAs":"textBox"},"csu":{"renderAs":"csuMap"},"newCsu":{"renderAs":"csuMap"},"comments":{"renderAs":"textBox"}}}</documentation>
      <extensionElements>
        <activiti:formProperty id="actualDate" name="Fecha Actual" type="date" variable="currentDate" default="08-10-2017 18:50" datePattern="MM-dd-yyyy hh:mm" required="true"></activiti:formProperty>
        <activiti:formProperty id="studentId" name="Identificador Alumno" type="string" variable="studentId" default="12345678" required="true"></activiti:formProperty>
        <activiti:formProperty id="student" name="Alumno" type="string" variable="student" default="Cecilia Flores" required="true"></activiti:formProperty>
        <activiti:formProperty id="studentEmail" name="Email del estudiante" type="string" variable="studentEmail" default="cecilia.flores@ilumno.com"></activiti:formProperty>
        <activiti:formProperty id="program" name="Programa" type="string" variable="program" default="Analista en Software" required="true"></activiti:formProperty>
        <activiti:formProperty id="csu" name="CSU Actual" type="json" variable="csu" default="{}" required="true"></activiti:formProperty>
        <activiti:formProperty id="newCsu" name="Nuevo CSU" type="json" variable="newCsu" default="{}" required="true"></activiti:formProperty>
        <activiti:formProperty id="comments" name="Observaciones" type="string" variable="studentComments"></activiti:formProperty>
        <activiti:executionListener event="start" class="com.ilumno.bps.pdp.listener.ProcessKeyListener"></activiti:executionListener>
        <activiti:executionListener event="start" class="com.ilumno.bps.pdp.listener.UserTaskProgressionListener">
          <activiti:field name="percentage">
            <activiti:string><![CDATA[0]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </startEvent>
    <callActivity id="Notificacion" name="Notificacion" calledElement="notificationProcess">
      <extensionElements>
        <activiti:in source="studentEmail" target="notificationRecipients"></activiti:in>
        <activiti:in sourceExpression="APPLICATION/BackOffice" target="notificationRecipientsGroup"></activiti:in>
        <activiti:in sourceExpression="NEW_PROCESS" target="notificationType"></activiti:in>
        <activiti:in source="processId" target="processId"></activiti:in>
        <activiti:in source="processDefinitionKey" target="processDefinitionKey"></activiti:in>
      </extensionElements>
    </callActivity>
    <callActivity id="createCrmCase" name="Crear Caso CRM" calledElement="crmCreationProcess">
      <extensionElements>
        <activiti:in sourceExpression="csuChange" target="caseType"></activiti:in>
        <activiti:in source="studentIdType" target="studentIdType"></activiti:in>
        <activiti:in source="studentId" target="studentId"></activiti:in>
        <activiti:out source="caseId" target="crmCaseId"></activiti:out>
      </extensionElements>
    </callActivity>
    <callActivity id="notifyGroups" name="Enviar Notificacion a Groups Responsables" calledElement="userNotificationProcess">
      <extensionElements>
        <activiti:in sourceExpression="csuChange" target="notificationType"></activiti:in>
        <activiti:in sourceExpression="APPLICATION/BackOffice" target="mailRecipientGroup"></activiti:in>
      </extensionElements>
    </callActivity>
    <sequenceFlow id="sid-2295E5D2-51B4-4841-B58B-76EF76208470" sourceRef="startForm" targetRef="Notificacion"></sequenceFlow>
    <sequenceFlow id="sid-806D3E4C-780F-4A73-94A7-68080BD47BD1" sourceRef="createCrmCase" targetRef="notifyUser"></sequenceFlow>
    <serviceTask id="fetchValidationValues" name="Obtener valores para Validación" activiti:class="com.ilumno.bps.pdp.task.BannerFetchCsuData"></serviceTask>
    <userTask id="validateRequest" name="Validar Solicitud">
      <documentation>{"translationPrefix":"requestApprovalForm","fields":{"scheduleHasCapacity":{"renderAs":"yesOrNo","source":"variable","data":"scheduleHasCapacity"},"financialStatus":{"renderAs":"label","source":"variable","data":"financialStatus"},"requestApproved":{"renderAs":"yesOrNo"}}}</documentation>
      <extensionElements>
        <activiti:formProperty id="requestApproved" name="Aprobación de Solicitud" type="boolean" variable="requestApproved"></activiti:formProperty>
        <activiti:executionListener event="start" class="com.ilumno.bps.pdp.listener.UserTaskProgressionListener">
          <activiti:field name="percentage">
            <activiti:string><![CDATA[0]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
        <activiti:executionListener event="end" class="com.ilumno.bps.pdp.listener.UserTaskProgressionListener">
          <activiti:field name="percentage">
            <activiti:string><![CDATA[100]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow1" sourceRef="fetchValidationValues" targetRef="validateRequest"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway1" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow2" sourceRef="validateRequest" targetRef="exclusivegateway1"></sequenceFlow>
    <serviceTask id="updateScheduleInBanner" name="Actualizar Jornada en Banner" activiti:class="com.ilumno.bps.pdp.task.BannerUpdateCaseTask"></serviceTask>
    <sequenceFlow id="flow3" sourceRef="exclusivegateway1" targetRef="updateScheduleInBanner">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${requestApproved}]]></conditionExpression>
    </sequenceFlow>
    <callActivity id="updateCrmCase" name="Actualizar Caso CRM" calledElement="crmUpdateProcess">
      <extensionElements>
        <activiti:in sourceExpression="close" target="status"></activiti:in>
        <activiti:in source="crmCaseId" target="caseId"></activiti:in>
      </extensionElements>
    </callActivity>
    <sequenceFlow id="flow6" sourceRef="exclusivegateway1" targetRef="updateCrmCase">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${!requestApproved}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow7" sourceRef="updateScheduleInBanner" targetRef="updateCrmCase"></sequenceFlow>
    <sequenceFlow id="flow10" sourceRef="notifyGroups" targetRef="fetchValidationValues"></sequenceFlow>
    <callActivity id="notifyUser" name="Enviar Notificaciones a Usuario" calledElement="userNotificationProcess">
      <extensionElements>
        <activiti:in sourceExpression="csuChange" target="notificationType"></activiti:in>
        <activiti:in source="studentEmail" target="mailRecipient"></activiti:in>
      </extensionElements>
    </callActivity>
    <sequenceFlow id="flow11" sourceRef="notifyUser" targetRef="notifyGroups"></sequenceFlow>
    <callActivity id="notifyClosureToUser" name="Enviar Notificación de Cierre a Usuario" calledElement="userNotificationProcess">
      <extensionElements>
        <activiti:in sourceExpression="csuChangeClosure" target="notificationType"></activiti:in>
        <activiti:in source="studentEmail" target="mailRecipient"></activiti:in>
      </extensionElements>
    </callActivity>
    <sequenceFlow id="flow12" sourceRef="updateCrmCase" targetRef="notifyClosureToUser"></sequenceFlow>
    <endEvent id="endevent1" name="End"></endEvent>
    <sequenceFlow id="flow13" sourceRef="notifyClosureToUser" targetRef="endingNotification"></sequenceFlow>
    <callActivity id="endingNotification" name="Notificacion" calledElement="notificationProcess">
      <extensionElements>
        <activiti:in source="studentEmail" target="notificationRecipients"></activiti:in>
        <activiti:in sourceExpression="APPLICATION/BackOffice" target="notificationRecipientsGroup"></activiti:in>
        <activiti:in sourceExpression="ENDED_PROCESS" target="notificationType"></activiti:in>
        <activiti:in source="processId" target="processId"></activiti:in>
        <activiti:in source="processDefinitionKey" target="processDefinitionKey"></activiti:in>
      </extensionElements>
    </callActivity>
    <sequenceFlow id="flow14" sourceRef="endingNotification" targetRef="endevent1"></sequenceFlow>
    <sequenceFlow id="flow15" sourceRef="Notificacion" targetRef="createCrmCase"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_Collaboration">
    <bpmndi:BPMNPlane bpmnElement="Collaboration" id="BPMNPlane_Collaboration">
      <bpmndi:BPMNShape bpmnElement="sid-DF77EB5C-7308-429E-8401-838B15EC5344" id="BPMNShape_sid-DF77EB5C-7308-429E-8401-838B15EC5344">
        <omgdc:Bounds height="427.0" width="1006.0" x="0.0" y="75.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-0AD809AE-4631-459E-97F9-A73F84FD514E" id="BPMNShape_sid-0AD809AE-4631-459E-97F9-A73F84FD514E">
        <omgdc:Bounds height="189.0" width="976.0" x="30.0" y="75.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="sid-D10A8765-2E2F-4B3D-BC65-790CB3CFEE03" id="BPMNShape_sid-D10A8765-2E2F-4B3D-BC65-790CB3CFEE03">
        <omgdc:Bounds height="237.0" width="976.0" x="30.0" y="264.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="startForm" id="BPMNShape_startForm">
        <omgdc:Bounds height="35.0" width="35.0" x="50.0" y="152.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="createCrmCase" id="BPMNShape_createCrmCase">
        <omgdc:Bounds height="55.0" width="127.0" x="330.0" y="142.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="notifyGroups" id="BPMNShape_notifyGroups">
        <omgdc:Bounds height="55.0" width="121.0" x="720.0" y="142.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="fetchValidationValues" id="BPMNShape_fetchValidationValues">
        <omgdc:Bounds height="55.0" width="105.0" x="120.0" y="330.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="validateRequest" id="BPMNShape_validateRequest">
        <omgdc:Bounds height="55.0" width="105.0" x="270.0" y="330.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="337.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="updateScheduleInBanner" id="BPMNShape_updateScheduleInBanner">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="420.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="updateCrmCase" id="BPMNShape_updateCrmCase">
        <omgdc:Bounds height="55.0" width="121.0" x="540.0" y="330.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="notifyUser" id="BPMNShape_notifyUser">
        <omgdc:Bounds height="55.0" width="105.0" x="540.0" y="142.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="notifyClosureToUser" id="BPMNShape_notifyClosureToUser">
        <omgdc:Bounds height="75.0" width="121.0" x="690.0" y="320.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="960.0" y="340.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endingNotification" id="BPMNShape_endingNotification">
        <omgdc:Bounds height="55.0" width="105.0" x="840.0" y="330.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Notificacion" id="BPMNShape_Notificacion">
        <omgdc:Bounds height="55.0" width="105.0" x="170.0" y="142.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="sid-2295E5D2-51B4-4841-B58B-76EF76208470" id="BPMNEdge_sid-2295E5D2-51B4-4841-B58B-76EF76208470">
        <omgdi:waypoint x="85.0" y="169.0"></omgdi:waypoint>
        <omgdi:waypoint x="170.0" y="169.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="sid-806D3E4C-780F-4A73-94A7-68080BD47BD1" id="BPMNEdge_sid-806D3E4C-780F-4A73-94A7-68080BD47BD1">
        <omgdi:waypoint x="457.0" y="169.0"></omgdi:waypoint>
        <omgdi:waypoint x="540.0" y="169.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="225.0" y="357.0"></omgdi:waypoint>
        <omgdi:waypoint x="270.0" y="357.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="375.0" y="357.0"></omgdi:waypoint>
        <omgdi:waypoint x="430.0" y="357.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="450.0" y="377.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="420.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6">
        <omgdi:waypoint x="470.0" y="357.0"></omgdi:waypoint>
        <omgdi:waypoint x="540.0" y="357.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
        <omgdi:waypoint x="450.0" y="420.0"></omgdi:waypoint>
        <omgdi:waypoint x="600.0" y="385.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow10" id="BPMNEdge_flow10">
        <omgdi:waypoint x="780.0" y="197.0"></omgdi:waypoint>
        <omgdi:waypoint x="570.0" y="294.0"></omgdi:waypoint>
        <omgdi:waypoint x="172.0" y="294.0"></omgdi:waypoint>
        <omgdi:waypoint x="172.0" y="330.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow11" id="BPMNEdge_flow11">
        <omgdi:waypoint x="645.0" y="169.0"></omgdi:waypoint>
        <omgdi:waypoint x="720.0" y="169.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow12" id="BPMNEdge_flow12">
        <omgdi:waypoint x="661.0" y="357.0"></omgdi:waypoint>
        <omgdi:waypoint x="690.0" y="357.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow13" id="BPMNEdge_flow13">
        <omgdi:waypoint x="811.0" y="357.0"></omgdi:waypoint>
        <omgdi:waypoint x="840.0" y="357.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow14" id="BPMNEdge_flow14">
        <omgdi:waypoint x="945.0" y="357.0"></omgdi:waypoint>
        <omgdi:waypoint x="960.0" y="357.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow15" id="BPMNEdge_flow15">
        <omgdi:waypoint x="275.0" y="169.0"></omgdi:waypoint>
        <omgdi:waypoint x="330.0" y="169.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
